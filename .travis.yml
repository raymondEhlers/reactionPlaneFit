# Needed for python 3.7
dist: xenial
language: python
python:
    - 3.6
    - 3.7
sudo: required
# Use cache with pip to save time.
cache: pip
install:
    # Needed on a separate line so that the packages install properly.
    - pip install --upgrade numpy cython
    - pip install --upgrade -e .[tests,dev,docs]
script:
    # Since we ran the tests above, we don't need to run them here.
    # Check code quality
    - flake8 .
    # Run the tests
    - pytest -l -vv --cov=reaction_plane_fit --cov-branch -m "not root" --durations=5 tests/
    # Check that the docs build successfully
    - pushd docs && make html && popd
after_success:
    # Upload coverage report to codecov.
    - bash <(curl -s https://codecov.io/bash)
jobs:
    include:
        - stage: deploy
          python: 3.7
          deploy:
              provider: pypi
              user: rehlers
              password:
                  secure: "UqMdGZrspE7Ob/xdmYPPP8YWXbWYORVJ6npNceyE0dGFtXvo3CqlRlJkejLs2P0tmbepVy7WxADfR4OffDcOVlRdXI7pmvwcuS7OHDA4IJ/MnzDMhGm58vPzTRj7vlPr+08M2IWXt7953RHpUOVo55t8PPbUiNAss0ioUPkQayP1SvhlUNRFA/ag1jeEKd8mo1mo2y28wyMbLRH5Omm1eeCrkplu7ypsMrz//1cTjkNChN+R0e58Kcz7NbBsWlpEltieEdiPeeZIOZ1P+Fk0jdU1BDh+k/u5Wo8R5df4DWy10950KF5hQVMxbDblEXvYc1BFpSDo433SsmT/G4XFItnNa+qjBrZ3GOUe08aPgQxguF7bTK7p2eQtNYcPM4bm58biSxTUE0Cu+qGB5iqe1fHHifygLRMXljFlnkQmr9/Ul++4tknv6wXmPYbmOnfhhcQvOhZE2vBCqE4W82DV4SlFfzt153xnatQ8joIXTmHu/2ygC2CGqdY/673o9aqOQc2R+UxrIkftg1bFJToTm4XK1s0e6UTStMp56UbRRnuQiBiJzMEOfDOheTxrEPrPAyRggPZmv7+2uSF6lLRQfSC7nLpwQCPK2wedn16yHC4vahlxehCcqFsJDtZ0pt4R4MD9m0LtFY9OgKVj2Uz3Ydx5IPdCPKhqxz3gToxTWng="
              distributions: sdist bdist_wheel
              on:
                  tags: true
